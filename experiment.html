<!DOCTYPE html>
<html>
  <head>
    <title>Alien language game</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
    <script src="consent/consent.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css"></link>
  </head>
  <body></body>
  <script>

    /* create timeline */
    var timeline = [];

    // utts
    var complex_utt = "<i>\"Toma zem zorp bidaku midu osh gipu!\"</i>"
    var simple_utt = "<i>\"Toma!\"</i>"


    //const random_utt = utts[Math.floor(Math.random() * utts.length)];

    // boxes
    var boxes = ['num_objects/box_1', 'num_objects/box_2']
    var mixed_boxes =  ['num_types/box_1', 'num_types/box_2']
    var entropy_boxes =  ['entropy/box_1', 'entropy/box_2']

    var all_boxes = [boxes, mixed_boxes, entropy_boxes];
    var box_type = jsPsych.randomization.repeat(all_boxes, 1)

    var shuffled_boxes = Object.values(jsPsych.randomization.repeat(box_type[0], 1)[0])

    var utts = [{utt: complex_utt,
        data: {utt_type: 'complex', test_part: 'test', boxes: shuffled_boxes}},
        {utt: simple_utt, data: {utt_type: 'simple', test_part: 'test', boxes: shuffled_boxes}}];

    var consent = {
      type:'external-html',
      url: "consent/consent.html",
      cont_btn: "start"
    };

    timeline.push(consent);

    /* define welcome message trial */
    var welcome_block = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome_block);

    /* define instructions trial */
    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, a circle will appear in the center " +
          "of the screen.</p><p>If the circle is <strong>blue</strong>, " +
          "press the letter F on the keyboard as fast as you can.</p>" +
          "<p>If the circle is <strong>orange</strong>, press the letter J " +
          "as fast as you can.</p>" +
          "<div style='width: 700px;'>"+
          "<div style='float: left;'><img src='img/blue.png'></img>" +
          "<p class='small'><strong>Press the F key</strong></p></div>" +
          "<div class='float: right;'><img src='img/orange.png'></img>" +
          "<p class='small'><strong>Press the J key</strong></p></div>" +
          "</div>"+
          "<p>Press any key to begin.</p>",
      post_trial_gap: 2000
    };
    timeline.push(instructions);

    var hi_alien = {
      type: 'html-button-response',
      stimulus: "<p>This is Dax the alien. He speaks an alien language." +
          '<br><br>He says, <i> "Difu Dax midaku."</i><br>' +
          'That means "Hello, my name is Dax."</p><br>' +

          "<div style='width: 700px;'>"+
          "<div style='float: center;'><img src='img/alien1.png' width='250' height='300'></img></div>" +
          "</div><br>",
      choices: ['Continue'],
      data: {test_part: 'setup'}
    }


    var show_box = {
      type: 'html-button-response',
      stimulus: function() { return "<p>Dax has a box. <br>" +
        " He opened the box and looked inside <br><br>" +
        "Then, Dax says, " + jsPsych.timelineVariable('utt', true) + "</p>" +
        "<div style='width: 700px;'>" +
        "<div style='float: center;'><img src='img/alien1.png' width='250' height='300'></img></div>" +
        "<div style='float: center;'><img src='img/grey_box.png'></img></div>"+
        "</div><br>";
      },
      choices: ['Continue'],
      data: {test_part: 'setup'}
    }

    var test_box = {
      type: 'html-button-response',
      stimulus: function(){ return "<p>Which box do you think Dax was " +
        "looking in when he said<br>" + jsPsych.timelineVariable('utt', true) + "?</p>" +
        "<div style='width: 700px;'>"+
        "</div>";
      },
      data: jsPsych.timelineVariable('data'),
      choices: shuffled_boxes,
      button_html: '<button style="border:none;"> <img width="250px" src = "img/%choice%.png"> </img> </button>'
    }

    var test_procedure = {
      timeline_variables: utts,
      timeline: [hi_alien, show_box, test_box],
      sample: {
        type: 'without-replacement',
        size: 1
      }
    }
    timeline.push(test_procedure);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });
  </script>
</html>
