---
title: "length-com-pilot"
output: html_document
---

```{r load-libraries, library, message=F, results='hide', warning=FALSE}
library(tidyverse)
library(here)
library(knitr)
library(tidyboot)
library(lme4)
library(broom.mixed)
library(RColorBrewer)
library(DT)
library(ggthemes)

opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, 
               error = FALSE, cache = TRUE, tidy = FALSE)
theme_set(theme_classic(base_size = 16))
```

```{r read-csv}
raw_data <- read.csv(here("data/run_2_within_ss.csv")) %>%
  filter(test_part == "box_selection" | test_part == "comment") %>%
  mutate(accuracy = as.numeric(accuracy),
         rt = rt/1000)
```

```{r subjs}
keep_subs <- raw_data %>%
  filter(test_part == "box_selection") %>%
  group_by(subid) %>%
  summarise(n = n_distinct(selected_box)) %>%
  filter(n > 1)
```

```{r analysis}
subj_data <- raw_data %>%
  filter(subid %in% keep_subs$subid, test_part == "box_selection") %>%
  mutate(chose_complex = if_else(selected_box == "box_2", 1, 0)) %>%
  pivot_longer(cols = c(accuracy, rt, chose_complex), names_to = "measure")

mean_data <- subj_data %>%
  group_by(measure, boxes_type, utt) %>%
  tidyboot_mean(value)
```

```{r plot, fig.width = 5, fig.height = 4}
ggplot(mean_data %>% filter(measure == "accuracy"),
       aes(fill = utt, x = boxes_type, y = empirical_stat)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), 
                width = 0.2, position=position_dodge(.9)) + 
  geom_hline(aes(yintercept = .5), linetype = "dashed") + 
  labs(x = "", y = "accuracy") + 
  scale_fill_ptol()

ggplot(mean_data %>% filter(measure == "rt"),
       aes(fill = utt, x = boxes_type, y = empirical_stat)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), 
                width = 0.2, position=position_dodge(.9)) + 
  labs(x = "", y = "response time (sec)") + 
  scale_fill_ptol()

ggplot(mean_data %>% filter(measure == "chose_complex"),
       aes(fill = utt, x = boxes_type, y = empirical_stat)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), 
                width = 0.2, position=position_dodge(.9)) + 
  geom_hline(aes(yintercept = .5), linetype = "dashed") + 
  labs(x = "", y = "chose complex (prop.)") + 
  scale_fill_ptol()
```

```{r list-responses}
raw_data %>% 
  group_by(subid) %>%
  filter(test_part == "comment") %>% 
  select(responses) %>%
  datatable()
```

